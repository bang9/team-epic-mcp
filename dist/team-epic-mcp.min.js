#!/usr/bin/env node
import{Server as B}from"@modelcontextprotocol/sdk/server/index.js";import{StdioServerTransport as Y}from"@modelcontextprotocol/sdk/server/stdio.js";import{ListToolsRequestSchema as Z,CallToolRequestSchema as W}from"@modelcontextprotocol/sdk/types.js";import{google as N}from"googleapis";import L from"axios";import{parse as V}from"csv-parse/sync";var R={name:"team-epic-mcp",version:"1.2.5",description:"MCP server for team project visibility using Google Sheets",type:"module",main:"dist/team-epic-mcp.js",bin:{"team-epic-mcp":"dist/team-epic-mcp.min.js"},scripts:{dev:"tsx src/index.ts",build:"esbuild src/index.ts --bundle --outfile=dist/team-epic-mcp.min.js --platform=node --target=node18 --format=esm --packages=external --minify --banner:js='#!/usr/bin/env node'",typecheck:"tsc --noEmit",lint:"eslint src/**/*.ts"},keywords:["mcp","team","project","google-sheets"],author:"",license:"MIT",dependencies:{"@modelcontextprotocol/sdk":"^0.5.0",axios:"^1.6.7","csv-parse":"^5.5.3",googleapis:"^134.0.0"},devDependencies:{"@types/node":"^20.11.19","@typescript-eslint/eslint-plugin":"^6.21.0","@typescript-eslint/parser":"^6.21.0",esbuild:"^0.25.5",eslint:"^8.56.0",tsx:"^4.7.1",typescript:"^5.3.3"}};var c={SPREADSHEET_ID:process.env.SPREADSHEET_ID||(()=>{throw new Error("SPREADSHEET_ID environment variable is required")})(),GOOGLE_SERVICE_ACCOUNT_BASE64:process.env.GOOGLE_SERVICE_ACCOUNT_BASE64,SHEET_NAMES:{EPICS:"Epics",EPIC_STATUS:"Epic_Status",STATUS_UPDATES:"Status_Updates",METADATA:"Metadata"},SHEET_GIDS:{EPICS:0,EPIC_STATUS:1,STATUS_UPDATES:2},CACHE_DURATION:parseInt(process.env.CACHE_DURATION||"60000"),SHEETS_API:{BASE_URL:"https://sheets.googleapis.com/v4/spreadsheets",EXPORT_URL:"https://docs.google.com/spreadsheets/d"}};function O(a){let e=Object.entries(c.SHEET_GIDS).find(([s,i])=>i===a);if(!e)throw new Error(`No sheet found for GID ${a}`);let t=e[0],r=c.SHEET_NAMES[t];return`https://docs.google.com/spreadsheets/d/${c.SPREADSHEET_ID}/gviz/tq?tqx=out:csv&sheet=${r}`}var k=R.version;function w(){let a=new Date,e=a.getFullYear(),t=Math.ceil((a.getMonth()+1)/3);return`${e}_Q${t}`}function C(a){let e=new Date(a),t=e.getFullYear(),r=Math.ceil((e.getMonth()+1)/3);return`${t}_Q${r}`}function E(a){return`Status_Updates_${a||w()}`}var D=class a{static{this.sheetVersionCache=null}static{this.migrationComplete=!1}static get isMigrationComplete(){return a.migrationComplete}constructor(e){this.sheetsClient=e}async checkAndMigrateIfNeeded(){if(a.migrationComplete)return;let e=k,t=await this.getSchemaVersion();this.needsMigration(t,e)&&(console.error(`Schema migration started: ${t} -> ${e}`),await this.executeMigration(t,e),await this.updateSchemaVersion(e),a.migrationComplete=!0,console.error(`Migration completed: ${t} -> ${e}`))}needsMigration(e,t){if(e===t)return!1;let r=n=>{let o=n.split(".").map(Number);return{major:o[0]||0,minor:o[1]||0,patch:o[2]||0}},s=r(e),i=r(t);return s.major!==i.major||s.minor!==i.minor}async getSchemaVersion(){if(a.sheetVersionCache)return a.sheetVersionCache;try{let r=(await this.sheetsClient.fetchSheet(c.SHEET_NAMES.METADATA,-1)).find(s=>s.key==="schema_version")?.value||"1.0.2";return a.sheetVersionCache=r,r}catch(e){console.error("Failed to fetch Metadata sheet:",e);let t=e?.message||"";if(t.includes("Unable to parse range")||t.includes("not found")){console.error("Metadata sheet does not exist. Creating it now...");try{await this.createMetadataSheet();let r="1.0.2";return a.sheetVersionCache=r,console.error(`Metadata sheet created successfully with initial schema version: ${r}`),r}catch(r){console.error("Failed to create Metadata sheet:",r),console.error("CreateError details:",JSON.stringify(r,null,2))}}return console.error("Using default schema version 1.0.2 due to Metadata sheet issues"),a.sheetVersionCache="1.0.2","1.0.2"}}async createMetadataSheet(){try{console.error(`Creating _Metadata sheet: ${c.SHEET_NAMES.METADATA}`);let e=await this.sheetsClient.createSheet(c.SHEET_NAMES.METADATA);console.error(`Sheet creation result: ${e}`);let t=[["key","value","updated_at"],["schema_version","1.0.2",new Date().toISOString()],["created_at",new Date().toISOString().split("T")[0],new Date().toISOString()],["last_migration","none",new Date().toISOString()]];console.error("Adding initial data to _Metadata sheet..."),await this.sheetsClient.updateValues(`${c.SHEET_NAMES.METADATA}!A1:C4`,t),console.error("_Metadata sheet created and initialized successfully")}catch(e){throw console.error("Failed to create _Metadata sheet:",e),console.error("Error details:",JSON.stringify(e,null,2)),e}}async updateSchemaVersion(e){await this.upsertMetadata("schema_version",e),a.sheetVersionCache=e}async upsertMetadata(e,t){try{let s=(await this.sheetsClient.fetchSheet(c.SHEET_NAMES.METADATA,-1)).findIndex(n=>n.key===e),i=[e,t,new Date().toISOString()];if(s>=0){let n=`${c.SHEET_NAMES.METADATA}!A${s+2}:C${s+2}`;await this.sheetsClient.updateValues(n,[i])}else await this.sheetsClient.appendValues(`${c.SHEET_NAMES.METADATA}!A:C`,[i])}catch(r){throw console.error(`Failed to upsert metadata ${e}:`,r),r}}async executeMigration(e,t){let r=n=>{let o=n.split(".").map(Number);return{major:o[0]||0,minor:o[1]||0,patch:o[2]||0}},s=r(e),i=r(t);s.major===1&&s.minor===0&&i.major===1&&i.minor>=1&&await this.migrate_1_0_2_to_1_1_0(),console.error(`Schema migration completed from ${e} to ${t}`)}async migrate_1_0_2_to_1_1_0(){console.error("Starting 1.0.2 -> 1.1.0 migration...");try{console.error("1. Adding created_quarter column to Epics sheet..."),await this.addCreatedQuarterColumn(),console.error("2. Assigning quarters to existing epics...");let e=await this.sheetsClient.fetchSheetData(c.SHEET_NAMES.EPICS,-1),t=await this.sheetsClient.fetchSheetData(c.SHEET_NAMES.STATUS_UPDATES,-1),r=new Map;for(let i of e){let n=this.estimateCreationQuarter(i,t);r.set(i.epic_id,n),await this.updateEpicQuarter(i.epic_id,n)}console.error("3. Creating quarterly Status_Updates sheets...");let s=[...new Set(r.values())];for(let i of s){let n=E(i);await this.sheetsClient.createSheet(n)}console.error("4. Migrating Status_Updates data to quarterly sheets..."),await this.migrateStatusUpdates(t,r),console.error("5. Clearing legacy Status_Updates sheet..."),await this.clearStatusUpdatesSheet(),console.error("1.0.2 -> 1.1.0 migration completed successfully!")}catch(e){throw console.error("Migration failed:",e),e}}async addCreatedQuarterColumn(){try{await this.sheetsClient.updateValues(`${c.SHEET_NAMES.EPICS}!L1`,[["created_quarter"]])}catch(e){throw console.error("Failed to add created_quarter column:",e),e}}estimateCreationQuarter(e,t){if(e.start_date&&e.start_date.trim())try{return C(e.start_date)}catch{console.warn(`Invalid start_date for epic ${e.epic_id}: ${e.start_date}`)}let r=t.filter(s=>s.epic_id===e.epic_id).sort((s,i)=>new Date(s.timestamp).getTime()-new Date(i.timestamp).getTime());if(r.length>0)try{return C(r[0].timestamp)}catch{console.warn(`Invalid timestamp for epic ${e.epic_id}: ${r[0].timestamp}`)}return w()}async updateEpicQuarter(e,t){try{let s=(await this.sheetsClient.fetchSheetData(c.SHEET_NAMES.EPICS,-1)).findIndex(i=>i.epic_id===e);if(s>=0){let i=`${c.SHEET_NAMES.EPICS}!L${s+2}`;await this.sheetsClient.updateValues(i,[[t]])}}catch(r){throw console.error(`Failed to update quarter for epic ${e}:`,r),r}}async migrateStatusUpdates(e,t){console.error(`Processing ${e.length} status updates for migration...`);let r=new Map;for(let s of e){let i=t.get(s.epic_id);i&&(r.has(i)||r.set(i,[]),r.get(i).push(s))}for(let[s,i]of r){let n=E(s);if(console.error(`Migrating ${i.length} updates to ${n}...`),await this.sheetsClient.updateValues(`${n}!A1:F1`,[["timestamp","epic_id","update_type","platform","message","author"]]),i.length>0){let p=[];for(let h=0;h<i.length;h+=1e3){let _=i.slice(h,h+1e3).map(l=>[l.timestamp,l.epic_id,l.update_type,l.platform||"",l.message,l.author]);p.push(_)}for(let h=0;h<p.length;h++)console.error(`Processing batch ${h+1}/${p.length} for ${n}...`),await this.sheetsClient.appendValues(`${n}!A:F`,p[h]),p.length>1&&await new Promise(d=>setTimeout(d,100))}}console.error("Status updates migration completed.")}async clearStatusUpdatesSheet(){try{await this.sheetsClient.updateValues(`${c.SHEET_NAMES.STATUS_UPDATES}!A2:Z`,[[]])}catch(e){throw console.error("Failed to clear Status_Updates sheet:",e),e}}},v=class{constructor(){this.cache=null;this.cacheTimestamp=0;this.initializeAuth(),this.sheets=N.sheets({version:"v4",auth:this.auth}),this.versionManager=new D(this)}initializeAuth(){let e=c.GOOGLE_SERVICE_ACCOUNT_BASE64;if(e)try{let t=Buffer.from(e,"base64").toString("utf-8"),r=JSON.parse(t);this.auth=new N.auth.GoogleAuth({credentials:r,scopes:["https://www.googleapis.com/auth/spreadsheets"]}),console.error("Service Account authentication initialized successfully")}catch(t){throw console.error("Failed to initialize Service Account authentication:",t),new Error("Invalid GOOGLE_SERVICE_ACCOUNT_BASE64 environment variable. Please ensure it contains a valid base64-encoded Service Account JSON.")}else console.warn("No Service Account credentials found. Operating in read-only mode."),this.auth=null}async fetchAllData(){let e=Date.now();if(this.cache&&e-this.cacheTimestamp<c.CACHE_DURATION)return this.cache;if(this.auth)try{let _=(await this.sheets.spreadsheets.values.batchGet({spreadsheetId:c.SPREADSHEET_ID,ranges:[`${c.SHEET_NAMES.EPICS}!A:Z`,`${c.SHEET_NAMES.EPIC_STATUS}!A:Z`]})).data.valueRanges||[],l=this.parseSheetData(_[0]?.values||[]),u=this.parseSheetData(_[1]?.values||[]),S=l.filter(m=>m.current_status!=="done"&&m.current_status!=="released"),g=[...new Set(S.map(m=>m.created_quarter).filter(Boolean))],T=[],M=new Set;for(let m of g){let y=E(m);try{let A=await this.sheets.spreadsheets.values.get({spreadsheetId:c.SPREADSHEET_ID,range:`${y}!A:Z`}),J=this.parseSheetData(A.data.values||[]);T.push(...J),M.add(m)}catch(A){console.warn(`Could not fetch ${y}:`,A)}}let q=w();if(!M.has(q)){let m=E();try{let y=await this.sheets.spreadsheets.values.get({spreadsheetId:c.SPREADSHEET_ID,range:`${m}!A:Z`}),A=this.parseSheetData(y.data.values||[]);T.push(...A)}catch(y){console.warn(`Could not fetch current quarter ${m}:`,y)}}try{let m=await this.sheets.spreadsheets.values.get({spreadsheetId:c.SPREADSHEET_ID,range:`${c.SHEET_NAMES.STATUS_UPDATES}!A:Z`}),y=this.parseSheetData(m.data.values||[]);T.push(...y)}catch(m){console.warn("Could not fetch legacy Status_Updates:",m)}return this.cache={epics:l,epicStatuses:u,statusUpdates:T},this.cacheTimestamp=e,this.cache}catch(d){console.error("Failed to batch fetch sheets:",d)}let t=E(),[r,s]=await Promise.all([this.fetchSheet("Epics",c.SHEET_GIDS.EPICS),this.fetchSheet("Epic_Status",c.SHEET_GIDS.EPIC_STATUS)]),i=r.filter(d=>d.current_status!=="done"&&d.current_status!=="released"),n=[...new Set(i.map(d=>d.created_quarter).filter(Boolean))],o=[],p=new Set;for(let d of n){let _=E(d);try{let l=await this.fetchSheet(_,-1);o.push(...l),p.add(d)}catch(l){console.warn(`Could not fetch ${_}:`,l)}}let h=w();if(!p.has(h))try{let d=await this.fetchSheet(t,-1);o.push(...d)}catch(d){console.warn(`Could not fetch current quarter ${t}:`,d)}try{let d=await this.fetchSheet("Status_Updates",c.SHEET_GIDS.STATUS_UPDATES);o.push(...d)}catch(d){console.warn("Could not fetch legacy Status_Updates:",d)}return this.cache={epics:r,epicStatuses:s,statusUpdates:o},this.cacheTimestamp=e,this.cache}parseSheetData(e){if(e.length===0)return[];let t=e[0];return e.slice(1).map(s=>{let i={};return t.forEach((n,o)=>{let p=s[o]||"";["ios_progress","android_progress","js_progress"].includes(n)?p=parseInt(p)||0:n==="is_carry_over"&&(p=p.toString().toLowerCase()==="true"),i[n]=p}),i})}async fetchSheet(e,t){try{if(this.auth){let s=(await this.sheets.spreadsheets.values.get({spreadsheetId:c.SPREADSHEET_ID,range:`${e}!A:Z`})).data.values||[];return this.parseSheetData(s)}else{let r=O(t),s=await L.get(r);return V(s.data,{columns:!0,skip_empty_lines:!0,trim:!0,cast:(n,o)=>o.column==="ios_progress"||o.column==="android_progress"||o.column==="js_progress"?parseInt(n)||0:o.column==="is_carry_over"?n.toLowerCase()==="true":n})}}catch(r){return console.error(`Failed to fetch ${e} sheet:`,r),[]}}async updateValues(e,t){if(!this.auth)throw new Error("Write operations require Service Account authentication. Please set GOOGLE_SERVICE_ACCOUNT_BASE64 environment variable.");try{let r=await this.sheets.spreadsheets.values.update({spreadsheetId:c.SPREADSHEET_ID,range:e,valueInputOption:"USER_ENTERED",requestBody:{values:t}});return this.clearCache(),r.status===200}catch(r){console.error("Failed to update values:",r);let s="Failed to update values";throw r.errors&&r.errors[0]?s=r.errors[0].message:r.message&&(s=r.message),r.code===403?s="Permission denied. Please ensure the Service Account has edit access to the spreadsheet.":r.code===404?s="Spreadsheet or range not found. Please check the spreadsheet ID and range.":r.code===401&&(s="Authentication failed. Please check your Service Account credentials."),new Error(s)}}async appendValues(e,t){if(!this.auth)throw new Error("Write operations require Service Account authentication. Please set GOOGLE_SERVICE_ACCOUNT_BASE64 environment variable.");try{console.error("Attempting to append values to:",e),console.error("Values to append:",JSON.stringify(t));let r=await this.sheets.spreadsheets.values.append({spreadsheetId:c.SPREADSHEET_ID,range:e,valueInputOption:"USER_ENTERED",requestBody:{values:t}});return console.error("Response status:",r.status),console.error("Values appended successfully"),this.clearCache(),r.status===200}catch(r){console.error("Failed to append values:",r);let s="Failed to append values";throw r.errors&&r.errors[0]?s=r.errors[0].message:r.message&&(s=r.message),r.code===403?s="Permission denied. Please ensure the Service Account has edit access to the spreadsheet.":r.code===404?s="Spreadsheet or range not found. Please check the spreadsheet ID and range.":r.code===401&&(s="Authentication failed. Please check your Service Account credentials."),new Error(s)}}async updateEpicStatus(e,t){try{let r=await this.fetchAllData(),s=r.epicStatuses.findIndex(i=>i.epic_id===e);if(s===-1){let i=[e,t.ios_progress||0,t.android_progress||0,t.js_progress||0,t.overall_status||"",t.last_comment||"",new Date().toISOString(),t.updated_by||"System"];return await this.appendValues(`${c.SHEET_NAMES.EPIC_STATUS}!A:H`,[i])}else{let i=`${c.SHEET_NAMES.EPIC_STATUS}!A${s+2}:H${s+2}`,n=r.epicStatuses[s],o=[e,t.ios_progress??n.ios_progress,t.android_progress??n.android_progress,t.js_progress??n.js_progress,t.overall_status??n.overall_status,t.last_comment??n.last_comment,new Date().toISOString(),t.updated_by??n.updated_by];return await this.updateValues(i,[o])}}catch(r){return console.error("Error updating epic status:",r),!1}}async addStatusUpdate(e){try{let t=[new Date().toISOString(),e.epic_id,e.update_type,e.platform||"",e.message,e.author],r=await this.getTargetSheetForUpdate(e.epic_id);return await this.appendValues(`${r}!A:F`,[t])}catch(t){return console.error("Error adding status update:",t),!1}}async getTargetSheetForUpdate(e){try{let r=(await this.fetchSheetData(c.SHEET_NAMES.EPICS,-1)).find(s=>s.epic_id===e);return r&&r.created_quarter?E(r.created_quarter):c.SHEET_NAMES.STATUS_UPDATES}catch(t){return console.error("Failed to determine target sheet for update:",t),c.SHEET_NAMES.STATUS_UPDATES}}async changeEpicStatus(e,t){try{let s=(await this.fetchAllData()).epics.findIndex(n=>n.epic_id===e);if(s===-1)return console.error(`Epic ${e} not found`),!1;let i=`${c.SHEET_NAMES.EPICS}!D${s+2}`;return await this.updateValues(i,[[t]])}catch(r){return console.error("Error changing epic status:",r),!1}}extractEpicIdFromUrl(e){let t=e.match(/\/browse\/([A-Z]+-\d+)$/);return t?t[1]:null}async createEpic(e){try{let t=this.extractEpicIdFromUrl(e.epic_url);if(!t)throw new Error("\uC62C\uBC14\uB978 Epic URL \uD615\uC2DD\uC774 \uC544\uB2D9\uB2C8\uB2E4. \uC608: https://company.atlassian.net/browse/PROJ-123");let r=e.epic_url,s=w(),i=[t,e.epic_name,r,e.initial_status||"backlog",e.ios_assignee,e.android_assignee,e.js_assignee,e.start_date,e.target_date,e.prd_link||"",e.tip_link||"",s];try{await this.appendValues(`${c.SHEET_NAMES.EPICS}!A:L`,[i])}catch(h){throw new Error(`Failed to add epic to Epics sheet: ${h.message}`)}let n=[t,0,0,0,e.initial_status||"backlog","Epic created",new Date().toISOString(),e.author];try{await this.appendValues(`${c.SHEET_NAMES.EPIC_STATUS}!A:H`,[n])}catch(h){throw new Error(`Failed to add epic to Epic_Status sheet: ${h.message}`)}let o={epic_id:t,update_type:"status_change",message:`Epic created: ${e.epic_name}`,author:e.author};return await this.addStatusUpdate(o)||console.error("Warning: Failed to add creation record to Status_Updates"),t}catch(t){throw t.message.includes("Permission denied")||t.message.includes("API key")?new Error("API key is missing or invalid. Please set GOOGLE_API_KEY environment variable."):t}}async fetchSheetData(e,t=-1){return this.fetchSheet(e,t)}async fetchEpicHistory(e){try{let r=(await this.fetchSheetData(c.SHEET_NAMES.EPICS,-1)).find(s=>s.epic_id===e);if(r&&r.created_quarter){let s=E(r.created_quarter);return(await this.fetchSheetData(s,-1)).filter(n=>n.epic_id===e)}else return(await this.fetchSheetData(c.SHEET_NAMES.STATUS_UPDATES,-1)).filter(i=>i.epic_id===e)}catch(t){return console.error(`Failed to fetch history for epic ${e}:`,t),[]}}async createSheet(e){if(!this.auth)throw new Error("Write operations require Service Account authentication. Please set GOOGLE_SERVICE_ACCOUNT_BASE64 environment variable.");try{let t=await this.sheets.spreadsheets.batchUpdate({spreadsheetId:c.SPREADSHEET_ID,requestBody:{requests:[{addSheet:{properties:{title:e}}}]}});return this.clearCache(),t.status===200}catch(t){if(console.error(`Failed to create sheet ${e}:`,t),t.message&&t.message.includes("already exists"))return!0;throw new Error(`Failed to create sheet ${e}: ${t.message}`)}}clearCache(){this.cache=null,this.cacheTimestamp=0}async checkAndMigrateIfNeeded(){return this.versionManager.checkAndMigrateIfNeeded()}};function F(a){return`\u{1F4CB} **${a.epic_name}** (${a.epic_id})
- \uC0C1\uD0DC: ${a.current_status}
- \uAE30\uAC04: ${a.start_date} ~ ${a.target_date}
- \uB2F4\uB2F9\uC790:
  - iOS: ${a.ios_assignee}
  - Android: ${a.android_assignee}
  - JS: ${a.js_assignee}
- [Epic Link](${a.epic_url})${a.prd_link?` | [PRD](${a.prd_link})`:""}${a.tip_link?` | [TIP](${a.tip_link})`:""}`}function $(a,e){let t=F(a);return e&&(t+=`

**\uD604\uC7AC \uC9C4\uD589 \uC0C1\uD669:**
- iOS: ${e.ios_progress}%
- Android: ${e.android_progress}%
- JS: ${e.js_progress}%
- \uC804\uCCB4 \uC0C1\uD0DC: ${e.overall_status}
- \uCD5C\uC2E0 \uCF54\uBA58\uD2B8: ${e.last_comment}
- \uC5C5\uB370\uC774\uD2B8: ${H(e.last_updated)} by ${e.updated_by}`),t}function U(a){let t={progress:"\u{1F4CA}",blocker:"\u{1F6AB}",resolved:"\u2705",comment:"\u{1F4AC}",status_change:"\u{1F504}"}[a.update_type]||"\u{1F4DD}",r=a.platform?`[${a.platform}] `:"";return`${t} **${H(a.timestamp)}** ${r}- ${a.message} (by ${a.author})`}function H(a){return new Date(a).toLocaleDateString("ko-KR",{month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"})}var P=[{name:"list_epics",description:"Epic \uBAA9\uB85D\uC744 \uC870\uD68C\uD569\uB2C8\uB2E4. \uC0C1\uD0DC\uC640 \uB2F4\uB2F9\uC790\uB85C \uD544\uD130\uB9C1 \uAC00\uB2A5\uD569\uB2C8\uB2E4.",inputSchema:{type:"object",properties:{status:{type:"string",description:"Epic \uC0C1\uD0DC \uD544\uD130",enum:["backlog","kickoff","planning","development","code_review","testing","ready_to_release","released","done","on_hold"]},assignee:{type:"string",description:"\uB2F4\uB2F9\uC790 \uBA58\uC158 (\uC608: @Airen Kang)"}}},handler:(a,e)=>{let t=a.epics;e.status&&(t=t.filter(s=>s.current_status===e.status)),e.assignee&&(t=t.filter(s=>s.ios_assignee===e.assignee||s.android_assignee===e.assignee||s.js_assignee===e.assignee));let r=t.length>0?t.map(s=>{let i=a.epicStatuses.find(n=>n.epic_id===s.epic_id);return $(s,i)}).join(`

---

`):"\uC870\uAC74\uC5D0 \uB9DE\uB294 Epic\uC774 \uC5C6\uC2B5\uB2C8\uB2E4.";return{content:[{type:"text",text:`# Epic \uBAA9\uB85D (${t.length}\uAC1C)

${r}`}]}}},{name:"get_epic_details",description:"\uD2B9\uC815 Epic\uC758 \uC0C1\uC138 \uC815\uBCF4\uC640 \uCD5C\uADFC \uC5C5\uB370\uC774\uD2B8\uB97C \uC870\uD68C\uD569\uB2C8\uB2E4.",inputSchema:{type:"object",properties:{epic_id:{type:"string",description:"Epic ID (\uC608: PROJ-123)"}},required:["epic_id"]},handler:(a,e)=>{let t=a.epics.find(n=>n.epic_id===e.epic_id);if(!t)return{content:[{type:"text",text:`Epic ID ${e.epic_id}\uB97C \uCC3E\uC744 \uC218 \uC5C6\uC2B5\uB2C8\uB2E4.`}]};let r=a.epicStatuses.find(n=>n.epic_id===e.epic_id),s=a.statusUpdates.filter(n=>n.epic_id===e.epic_id).sort((n,o)=>new Date(o.timestamp).getTime()-new Date(n.timestamp).getTime()).slice(0,10),i=`# Epic \uC0C1\uC138 \uC815\uBCF4

${$(t,r)}

`;return s.length>0&&(i+=`## \u{1F4DC} \uCD5C\uADFC \uC5C5\uB370\uC774\uD2B8 (${s.length}\uAC1C)

`,i+=s.map(U).join(`
`)),{content:[{type:"text",text:i}]}}},{name:"get_epic_timeline",description:"\uD2B9\uC815 Epic\uC758 \uC804\uCCB4 \uD0C0\uC784\uB77C\uC778\uC744 \uC870\uD68C\uD569\uB2C8\uB2E4.",inputSchema:{type:"object",properties:{epic_id:{type:"string",description:"Epic ID"},limit:{type:"number",description:"\uC870\uD68C\uD560 \uC5C5\uB370\uC774\uD2B8 \uC218 (\uAE30\uBCF8\uAC12: 50)",default:50}},required:["epic_id"]},handler:(a,e)=>{let t=a.epics.find(i=>i.epic_id===e.epic_id);if(!t)return{content:[{type:"text",text:`Epic ID ${e.epic_id}\uB97C \uCC3E\uC744 \uC218 \uC5C6\uC2B5\uB2C8\uB2E4.`}]};let r=a.statusUpdates.filter(i=>i.epic_id===e.epic_id).sort((i,n)=>new Date(n.timestamp).getTime()-new Date(i.timestamp).getTime()).slice(0,e.limit||50),s=`# ${t.epic_name} \uD0C0\uC784\uB77C\uC778

`;return r.length>0?s+=r.map(U).join(`
`):s+="\uC544\uC9C1 \uC5C5\uB370\uC774\uD2B8\uAC00 \uC5C6\uC2B5\uB2C8\uB2E4.",{content:[{type:"text",text:s}]}}},{name:"get_team_progress",description:"\uD300 \uC804\uCCB4\uC758 Epic \uC9C4\uD589 \uC0C1\uD669\uC744 \uC694\uC57D\uD569\uB2C8\uB2E4.",inputSchema:{type:"object",properties:{}},handler:(a,e)=>{let t=a.epics.filter(u=>!["backlog","done","released","on_hold"].includes(u.current_status)),r={};t.forEach(u=>{r[u.current_status]=(r[u.current_status]||0)+1});let s=0,i=0,n=0,o=0;t.forEach(u=>{let S=a.epicStatuses.find(g=>g.epic_id===u.epic_id);S&&(s+=S.ios_progress,i+=S.android_progress,n+=S.js_progress,o++)});let p=o>0?Math.round(s/o):0,h=o>0?Math.round(i/o):0,d=o>0?Math.round(n/o):0,_=a.statusUpdates.filter(u=>u.update_type==="blocker").filter(u=>!a.statusUpdates.find(g=>g.epic_id===u.epic_id&&g.update_type==="resolved"&&new Date(g.timestamp)>new Date(u.timestamp))),l=`# \u{1F3E2} \uD300 \uC9C4\uD589 \uD604\uD669

`;return l+=`## \u{1F4CA} Epic \uC0C1\uD0DC \uBD84\uD3EC
`,Object.entries(r).forEach(([u,S])=>{l+=`- ${u}: ${S}\uAC1C
`}),l+=`
## \u{1F3AF} \uD50C\uB7AB\uD3FC\uBCC4 \uD3C9\uADE0 \uC9C4\uD589\uB960
`,l+=`- iOS: ${p}%
`,l+=`- Android: ${h}%
`,l+=`- JS: ${d}%
`,_.length>0&&(l+=`
## \u{1F6AB} \uD604\uC7AC \uBE14\uB85C\uCEE4 (${_.length}\uAC1C)
`,_.slice(0,5).forEach(u=>{let S=a.epics.find(g=>g.epic_id===u.epic_id);l+=`- **${S?.epic_name||u.epic_id}**: ${u.message}
`})),{content:[{type:"text",text:l}]}}},{name:"find_blockers",description:"\uD574\uACB0\uB418\uC9C0 \uC54A\uC740 \uBE14\uB85C\uCEE4\uAC00 \uC788\uB294 Epic\uC744 \uCC3E\uC2B5\uB2C8\uB2E4.",inputSchema:{type:"object",properties:{}},handler:(a,e)=>{let t={};a.statusUpdates.forEach(i=>{i.update_type==="blocker"&&(a.statusUpdates.find(o=>o.epic_id===i.epic_id&&o.update_type==="resolved"&&o.platform===i.platform&&new Date(o.timestamp)>new Date(i.timestamp))||(t[i.epic_id]||(t[i.epic_id]=[]),t[i.epic_id].push(i)))});let r=Object.keys(t);if(r.length===0)return{content:[{type:"text",text:"\uD604\uC7AC \uD574\uACB0\uB418\uC9C0 \uC54A\uC740 \uBE14\uB85C\uCEE4\uAC00 \uC5C6\uC2B5\uB2C8\uB2E4. \u{1F389}"}]};let s=`# \u{1F6AB} \uBE14\uB85C\uCEE4\uAC00 \uC788\uB294 Epic (${r.length}\uAC1C)

`;return r.forEach(i=>{let n=a.epics.find(p=>p.epic_id===i),o=t[i];s+=`## ${n?.epic_name||i}
`,o.forEach(p=>{s+=U(p)+`
`}),s+=`
`}),{content:[{type:"text",text:s}]}}},{name:"search_by_assignee",description:"\uD2B9\uC815 \uB2F4\uB2F9\uC790\uAC00 \uD560\uB2F9\uB41C Epic\uC744 \uAC80\uC0C9\uD569\uB2C8\uB2E4.",inputSchema:{type:"object",properties:{assignee:{type:"string",description:"\uB2F4\uB2F9\uC790 \uBA58\uC158 (\uC608: @Airen Kang)"},platform:{type:"string",description:"\uD50C\uB7AB\uD3FC \uD544\uD130",enum:["iOS","Android","JS"]}},required:["assignee"]},handler:(a,e)=>{let t=a.epics;if(e.platform)switch(e.platform){case"iOS":t=t.filter(n=>n.ios_assignee===e.assignee);break;case"Android":t=t.filter(n=>n.android_assignee===e.assignee);break;case"JS":t=t.filter(n=>n.js_assignee===e.assignee);break}else t=t.filter(n=>n.ios_assignee===e.assignee||n.android_assignee===e.assignee||n.js_assignee===e.assignee);let r=t.filter(n=>!["done","released"].includes(n.current_status)),s=t.filter(n=>["done","released"].includes(n.current_status)),i=`# ${e.assignee}\uB2D8\uC758 Epic

`;return r.length>0&&(i+=`## \u{1F504} \uC9C4\uD589\uC911 (${r.length}\uAC1C)

`,r.forEach(n=>{let o=a.epicStatuses.find(p=>p.epic_id===n.epic_id);i+=$(n,o)+`

`})),s.length>0&&(i+=`## \u2705 \uC644\uB8CC (${s.length}\uAC1C)

`,s.forEach(n=>{i+=`- ${n.epic_name} (${n.epic_id})
`})),t.length===0&&(i=`${e.assignee}\uB2D8\uC5D0\uAC8C \uD560\uB2F9\uB41C Epic\uC774 \uC5C6\uC2B5\uB2C8\uB2E4.`),{content:[{type:"text",text:i}]}}}];var f=a=>{let e=a.match(/\/browse\/([A-Z]+-\d+)$/);return e?e[1]:null},I=a=>a.startsWith("@")&&a.length>1,j=a=>{if(!/^\d{4}-\d{2}-\d{2}$/.test(a))return!1;let t=new Date(a);return t instanceof Date&&!isNaN(t.getTime())},Q=a=>f(a)!==null,b=[{name:"create_epic",description:"\uC0C8\uB85C\uC6B4 Epic\uC744 \uC0DD\uC131\uD569\uB2C8\uB2E4.",inputSchema:{type:"object",properties:{epic_name:{type:"string",description:"Epic \uC774\uB984"},ios_assignee:{type:"string",description:"iOS \uB2F4\uB2F9\uC790 (\uC608: @Airen Kang)"},android_assignee:{type:"string",description:"Android \uB2F4\uB2F9\uC790 (\uC608: @John Kim)"},js_assignee:{type:"string",description:"JS \uB2F4\uB2F9\uC790 (\uC608: @Sarah Lee)"},start_date:{type:"string",description:"\uC2DC\uC791\uC77C (YYYY-MM-DD \uD615\uC2DD)"},target_date:{type:"string",description:"\uBAA9\uD45C\uC77C (YYYY-MM-DD \uD615\uC2DD)"},epic_url:{type:"string",description:"Epic URL (\uC120\uD0DD\uC0AC\uD56D, \uC790\uB3D9 \uC0DD\uC131\uB428)"},prd_link:{type:"string",description:"PRD \uB9C1\uD06C (\uC120\uD0DD\uC0AC\uD56D)"},tip_link:{type:"string",description:"TIP \uB9C1\uD06C (\uC120\uD0DD\uC0AC\uD56D)"},initial_status:{type:"string",description:"\uCD08\uAE30 \uC0C1\uD0DC (\uC120\uD0DD\uC0AC\uD56D, \uAE30\uBCF8\uAC12: backlog)",enum:["backlog","kickoff","planning","development","code_review","testing","ready_to_release","released","done","on_hold"]},author:{type:"string",description:"\uC0DD\uC131\uC790"}},required:["epic_name","epic_url","ios_assignee","android_assignee","js_assignee","start_date","target_date","author"]},handler:async(a,e)=>{let t=[];if(Q(e.epic_url)||t.push("Epic URL \uD615\uC2DD\uC774 \uC62C\uBC14\uB974\uC9C0 \uC54A\uC2B5\uB2C8\uB2E4. \uC608: https://company.atlassian.net/browse/PROJ-123"),I(e.ios_assignee)||t.push("iOS \uB2F4\uB2F9\uC790\uB294 @\uB85C \uC2DC\uC791\uD574\uC57C \uD569\uB2C8\uB2E4"),I(e.android_assignee)||t.push("Android \uB2F4\uB2F9\uC790\uB294 @\uB85C \uC2DC\uC791\uD574\uC57C \uD569\uB2C8\uB2E4"),I(e.js_assignee)||t.push("JS \uB2F4\uB2F9\uC790\uB294 @\uB85C \uC2DC\uC791\uD574\uC57C \uD569\uB2C8\uB2E4"),j(e.start_date)||t.push("\uC2DC\uC791\uC77C\uC740 YYYY-MM-DD \uD615\uC2DD\uC774\uC5B4\uC57C \uD569\uB2C8\uB2E4"),j(e.target_date)||t.push("\uBAA9\uD45C\uC77C\uC740 YYYY-MM-DD \uD615\uC2DD\uC774\uC5B4\uC57C \uD569\uB2C8\uB2E4"),new Date(e.start_date)>new Date(e.target_date)&&t.push("\uC2DC\uC791\uC77C\uC740 \uBAA9\uD45C\uC77C\uBCF4\uB2E4 \uC774\uC804\uC774\uC5B4\uC57C \uD569\uB2C8\uB2E4"),e.epic_name.trim().length<3&&t.push("Epic \uC774\uB984\uC740 \uCD5C\uC18C 3\uC790 \uC774\uC0C1\uC774\uC5B4\uC57C \uD569\uB2C8\uB2E4"),t.length>0)return{content:[{type:"text",text:`\u274C \uC785\uB825 \uC624\uB958:
${t.map(r=>`- ${r}`).join(`
`)}`}]};try{return f(e.epic_url)?{content:[{type:"text",text:`\u2705 \uC0C8\uB85C\uC6B4 Epic\uC774 \uC0DD\uC131\uB418\uC5C8\uC2B5\uB2C8\uB2E4!

**Epic ID**: ${await a.createEpic(e)}
**Epic \uC774\uB984**: ${e.epic_name}
**\uB2F4\uB2F9\uC790**:
- iOS: ${e.ios_assignee}
- Android: ${e.android_assignee}
- JS: ${e.js_assignee}
**\uAE30\uAC04**: ${e.start_date} ~ ${e.target_date}
**\uC0C1\uD0DC**: ${e.initial_status||"backlog"}

Epic\uC774 \uC131\uACF5\uC801\uC73C\uB85C \uC0DD\uC131\uB418\uC5C8\uC2B5\uB2C8\uB2E4. \uC2A4\uD504\uB808\uB4DC\uC2DC\uD2B8\uC5D0\uC11C \uD655\uC778\uD558\uC138\uC694.`}]}:{content:[{type:"text",text:`\u274C Epic URL\uC5D0\uC11C ID\uB97C \uCD94\uCD9C\uD560 \uC218 \uC5C6\uC2B5\uB2C8\uB2E4: ${e.epic_url}`}]}}catch(r){console.error("Epic creation error:",r),console.error("Epic data:",e);let s="\uC54C \uC218 \uC5C6\uB294 \uC624\uB958";return r instanceof Error&&(s=r.message,r.message.includes("API key")?s+=`

API \uD0A4 \uC124\uC815\uC744 \uD655\uC778\uD574\uC8FC\uC138\uC694. MCP \uC11C\uBC84 \uD658\uACBD\uC5D0 GOOGLE_API_KEY\uAC00 \uC124\uC815\uB418\uC5B4 \uC788\uC5B4\uC57C \uD569\uB2C8\uB2E4.`:r.message.includes("Permission denied")?s+=`

\uC2A4\uD504\uB808\uB4DC\uC2DC\uD2B8 \uAD8C\uD55C\uC744 \uD655\uC778\uD574\uC8FC\uC138\uC694. API \uD0A4\uAC00 \uD574\uB2F9 \uC2A4\uD504\uB808\uB4DC\uC2DC\uD2B8\uC5D0 \uC4F0\uAE30 \uAD8C\uD55C\uC774 \uC788\uC5B4\uC57C \uD569\uB2C8\uB2E4.`:r.message.includes("404")&&(s+=`

\uC2A4\uD504\uB808\uB4DC\uC2DC\uD2B8 ID\uB098 \uC2DC\uD2B8 \uC774\uB984\uC774 \uC62C\uBC14\uB978\uC9C0 \uD655\uC778\uD574\uC8FC\uC138\uC694.`)),{content:[{type:"text",text:`\u274C Epic \uC0DD\uC131 \uC911 \uC624\uB958\uAC00 \uBC1C\uC0DD\uD588\uC2B5\uB2C8\uB2E4: ${s}`}]}}}},{name:"update_progress",description:"\uD50C\uB7AB\uD3FC\uBCC4 \uC9C4\uD589\uB960\uC744 \uC5C5\uB370\uC774\uD2B8\uD569\uB2C8\uB2E4. \uAC00\uC7A5 \uC790\uC8FC \uC0AC\uC6A9\uB418\uB294 \uAE30\uB2A5\uC785\uB2C8\uB2E4.",inputSchema:{type:"object",properties:{epic_url:{type:"string",description:"Epic URL (\uC608: https://company.atlassian.net/browse/PROJ-123)"},platform:{type:"string",description:"\uD50C\uB7AB\uD3FC",enum:["iOS","Android","JS"]},progress:{type:"number",description:"\uC9C4\uD589\uB960 (0-100)",minimum:0,maximum:100},comment:{type:"string",description:"\uC9C4\uD589 \uC0C1\uD669 \uCF54\uBA58\uD2B8 (\uC120\uD0DD\uC0AC\uD56D)"},author:{type:"string",description:"\uC791\uC131\uC790 (\uC608: @Airen Kang)"}},required:["epic_url","platform","progress","author"]},handler:async(a,e)=>{try{let t=f(e.epic_url);if(!t)return{content:[{type:"text",text:"\u274C \uC62C\uBC14\uB978 Epic URL \uD615\uC2DD\uC774 \uC544\uB2D9\uB2C8\uB2E4. \uC608: https://company.atlassian.net/browse/PROJ-123"}]};if(!(await a.fetchAllData()).epics.find(p=>p.epic_id===t))return{content:[{type:"text",text:`\u274C Epic ${t}\uB97C \uCC3E\uC744 \uC218 \uC5C6\uC2B5\uB2C8\uB2E4.`}]};let i={updated_by:e.author};switch(e.platform){case"iOS":i.ios_progress=e.progress;break;case"Android":i.android_progress=e.progress;break;case"JS":i.js_progress=e.progress;break}e.comment&&(i.last_comment=e.comment);let n=await a.updateEpicStatus(t,i),o=await a.addStatusUpdate({epic_id:t,update_type:"progress",platform:e.platform,message:`${e.progress}% \uC644\uB8CC${e.comment?` - ${e.comment}`:""}`,author:e.author});return n&&o?{content:[{type:"text",text:`\u2705 ${t}\uC758 ${e.platform} \uC9C4\uD589\uB960\uC774 ${e.progress}%\uB85C \uC5C5\uB370\uC774\uD2B8\uB418\uC5C8\uC2B5\uB2C8\uB2E4.`}]}:{content:[{type:"text",text:`\u274C \uC5C5\uB370\uC774\uD2B8 \uC911 \uC624\uB958\uAC00 \uBC1C\uC0DD\uD588\uC2B5\uB2C8\uB2E4. (Status Update: ${n}, History: ${o})`}]}}catch(t){console.error("Progress update error:",t);let r="\uC54C \uC218 \uC5C6\uB294 \uC624\uB958";return t instanceof Error&&(r=t.message),{content:[{type:"text",text:`\u274C \uC9C4\uD589\uB960 \uC5C5\uB370\uC774\uD2B8 \uC911 \uC624\uB958\uAC00 \uBC1C\uC0DD\uD588\uC2B5\uB2C8\uB2E4: ${r}`}]}}}},{name:"add_comment",description:"Epic\uC5D0 \uCF54\uBA58\uD2B8\uB97C \uCD94\uAC00\uD569\uB2C8\uB2E4. \uD604\uC7AC \uC0C1\uD669\uC744 \uBE60\uB974\uAC8C \uACF5\uC720\uD560 \uB54C \uC0AC\uC6A9\uD569\uB2C8\uB2E4.",inputSchema:{type:"object",properties:{epic_url:{type:"string",description:"Epic URL (\uC608: https://company.atlassian.net/browse/PROJ-123)"},comment:{type:"string",description:"\uCF54\uBA58\uD2B8 \uB0B4\uC6A9"},platform:{type:"string",description:"\uD50C\uB7AB\uD3FC (\uC120\uD0DD\uC0AC\uD56D)",enum:["iOS","Android","JS"]},author:{type:"string",description:"\uC791\uC131\uC790"}},required:["epic_url","comment","author"]},handler:async(a,e)=>{try{let t=f(e.epic_url);if(!t)return{content:[{type:"text",text:"\u274C \uC62C\uBC14\uB978 Epic URL \uD615\uC2DD\uC774 \uC544\uB2D9\uB2C8\uB2E4. \uC608: https://company.atlassian.net/browse/PROJ-123"}]};let r=await a.updateEpicStatus(t,{last_comment:e.comment,updated_by:e.author}),s=await a.addStatusUpdate({epic_id:t,update_type:"comment",platform:e.platform,message:e.comment,author:e.author});return r&&s?{content:[{type:"text",text:"\u{1F4AC} \uCF54\uBA58\uD2B8\uAC00 \uCD94\uAC00\uB418\uC5C8\uC2B5\uB2C8\uB2E4."}]}:{content:[{type:"text",text:`\u274C \uCF54\uBA58\uD2B8 \uCD94\uAC00 \uC911 \uC624\uB958\uAC00 \uBC1C\uC0DD\uD588\uC2B5\uB2C8\uB2E4. (Status Update: ${r}, History: ${s})`}]}}catch(t){console.error("Comment add error:",t);let r="\uC54C \uC218 \uC5C6\uB294 \uC624\uB958";return t instanceof Error&&(r=t.message),{content:[{type:"text",text:`\u274C \uCF54\uBA58\uD2B8 \uCD94\uAC00 \uC911 \uC624\uB958\uAC00 \uBC1C\uC0DD\uD588\uC2B5\uB2C8\uB2E4: ${r}`}]}}}},{name:"report_blocker",description:"\uBE14\uB85C\uCEE4\uB97C \uB4F1\uB85D\uD569\uB2C8\uB2E4. \uC791\uC5C5\uC744 \uB9C9\uB294 \uC774\uC288\uAC00 \uBC1C\uC0DD\uD588\uC744 \uB54C \uC0AC\uC6A9\uD569\uB2C8\uB2E4.",inputSchema:{type:"object",properties:{epic_url:{type:"string",description:"Epic URL (\uC608: https://company.atlassian.net/browse/PROJ-123)"},platform:{type:"string",description:"\uBE14\uB85C\uCEE4\uAC00 \uBC1C\uC0DD\uD55C \uD50C\uB7AB\uD3FC",enum:["iOS","Android","JS"]},description:{type:"string",description:"\uBE14\uB85C\uCEE4 \uC124\uBA85"},author:{type:"string",description:"\uBCF4\uACE0\uC790"}},required:["epic_url","platform","description","author"]},handler:async(a,e)=>{let t=f(e.epic_url);if(!t)return{content:[{type:"text",text:"\u274C \uC62C\uBC14\uB978 Epic URL \uD615\uC2DD\uC774 \uC544\uB2D9\uB2C8\uB2E4. \uC608: https://company.atlassian.net/browse/PROJ-123"}]};let r=await a.addStatusUpdate({epic_id:t,update_type:"blocker",platform:e.platform,message:e.description,author:e.author});return await a.updateEpicStatus(t,{last_comment:`\u{1F6AB} [${e.platform}] \uBE14\uB85C\uCEE4: ${e.description}`,updated_by:e.author}),r?{content:[{type:"text",text:`\u{1F6AB} \uBE14\uB85C\uCEE4\uAC00 \uB4F1\uB85D\uB418\uC5C8\uC2B5\uB2C8\uB2E4: ${e.description}`}]}:{content:[{type:"text",text:"\u274C \uBE14\uB85C\uCEE4 \uB4F1\uB85D \uC911 \uC624\uB958\uAC00 \uBC1C\uC0DD\uD588\uC2B5\uB2C8\uB2E4."}]}}},{name:"resolve_blocker",description:"\uBE14\uB85C\uCEE4\uB97C \uD574\uACB0 \uCC98\uB9AC\uD569\uB2C8\uB2E4.",inputSchema:{type:"object",properties:{epic_url:{type:"string",description:"Epic URL (\uC608: https://company.atlassian.net/browse/PROJ-123)"},platform:{type:"string",description:"\uD574\uACB0\uB41C \uD50C\uB7AB\uD3FC",enum:["iOS","Android","JS"]},resolution:{type:"string",description:"\uD574\uACB0 \uBC29\uBC95 \uC124\uBA85"},author:{type:"string",description:"\uD574\uACB0\uC790"}},required:["epic_url","platform","resolution","author"]},handler:async(a,e)=>{let t=f(e.epic_url);if(!t)return{content:[{type:"text",text:"\u274C \uC62C\uBC14\uB978 Epic URL \uD615\uC2DD\uC774 \uC544\uB2D9\uB2C8\uB2E4. \uC608: https://company.atlassian.net/browse/PROJ-123"}]};let r=await a.addStatusUpdate({epic_id:t,update_type:"resolved",platform:e.platform,message:e.resolution,author:e.author});return await a.updateEpicStatus(t,{last_comment:`\u2705 [${e.platform}] \uBE14\uB85C\uCEE4 \uD574\uACB0: ${e.resolution}`,updated_by:e.author}),r?{content:[{type:"text",text:"\u2705 \uBE14\uB85C\uCEE4\uAC00 \uD574\uACB0\uB418\uC5C8\uC2B5\uB2C8\uB2E4!"}]}:{content:[{type:"text",text:"\u274C \uBE14\uB85C\uCEE4 \uD574\uACB0 \uCC98\uB9AC \uC911 \uC624\uB958\uAC00 \uBC1C\uC0DD\uD588\uC2B5\uB2C8\uB2E4."}]}}},{name:"change_epic_status",description:"Epic\uC758 \uC804\uCCB4 \uC0C1\uD0DC\uB97C \uBCC0\uACBD\uD569\uB2C8\uB2E4. (\uC608: planning \u2192 development)",inputSchema:{type:"object",properties:{epic_url:{type:"string",description:"Epic URL (\uC608: https://company.atlassian.net/browse/PROJ-123)"},new_status:{type:"string",description:"\uC0C8\uB85C\uC6B4 \uC0C1\uD0DC",enum:["backlog","kickoff","planning","development","code_review","testing","ready_to_release","released","done","on_hold"]},reason:{type:"string",description:"\uC0C1\uD0DC \uBCC0\uACBD \uC774\uC720 (\uC120\uD0DD\uC0AC\uD56D)"},author:{type:"string",description:"\uBCC0\uACBD\uC790"}},required:["epic_url","new_status","author"]},handler:async(a,e)=>{let t=f(e.epic_url);if(!t)return{content:[{type:"text",text:"\u274C \uC62C\uBC14\uB978 Epic URL \uD615\uC2DD\uC774 \uC544\uB2D9\uB2C8\uB2E4. \uC608: https://company.atlassian.net/browse/PROJ-123"}]};let r=await a.changeEpicStatus(t,e.new_status),s=e.reason?`\uC0C1\uD0DC \uBCC0\uACBD: ${e.new_status} - ${e.reason}`:`\uC0C1\uD0DC \uBCC0\uACBD: ${e.new_status}`,i=await a.addStatusUpdate({epic_id:t,update_type:"status_change",message:s,author:e.author});return await a.updateEpicStatus(t,{overall_status:e.new_status,last_comment:s,updated_by:e.author}),r&&i?{content:[{type:"text",text:`\u{1F504} Epic \uC0C1\uD0DC\uAC00 ${e.new_status}\uB85C \uBCC0\uACBD\uB418\uC5C8\uC2B5\uB2C8\uB2E4.`}]}:{content:[{type:"text",text:"\u274C \uC0C1\uD0DC \uBCC0\uACBD \uC911 \uC624\uB958\uAC00 \uBC1C\uC0DD\uD588\uC2B5\uB2C8\uB2E4."}]}}},{name:"mark_platform_done",description:"\uD2B9\uC815 \uD50C\uB7AB\uD3FC\uC758 \uC791\uC5C5\uC744 \uC644\uB8CC \uCC98\uB9AC\uD569\uB2C8\uB2E4.",inputSchema:{type:"object",properties:{epic_url:{type:"string",description:"Epic URL (\uC608: https://company.atlassian.net/browse/PROJ-123)"},platform:{type:"string",description:"\uC644\uB8CC\uB41C \uD50C\uB7AB\uD3FC",enum:["iOS","Android","JS"]},author:{type:"string",description:"\uC644\uB8CC \uCC98\uB9AC\uC790"}},required:["epic_url","platform","author"]},handler:async(a,e)=>{let t=f(e.epic_url);if(!t)return{content:[{type:"text",text:"\u274C \uC62C\uBC14\uB978 Epic URL \uD615\uC2DD\uC774 \uC544\uB2D9\uB2C8\uB2E4. \uC608: https://company.atlassian.net/browse/PROJ-123"}]};let r={updated_by:e.author,last_comment:`${e.platform} \uAC1C\uBC1C \uC644\uB8CC`};switch(e.platform){case"iOS":r.ios_progress=100;break;case"Android":r.android_progress=100;break;case"JS":r.js_progress=100;break}let s=await a.updateEpicStatus(t,r),i=await a.addStatusUpdate({epic_id:t,update_type:"progress",platform:e.platform,message:"\uAC1C\uBC1C \uC644\uB8CC (100%)",author:e.author});return s&&i?{content:[{type:"text",text:`\u{1F389} ${e.platform} \uD50C\uB7AB\uD3FC \uC791\uC5C5\uC774 \uC644\uB8CC\uB418\uC5C8\uC2B5\uB2C8\uB2E4!`}]}:{content:[{type:"text",text:"\u274C \uC644\uB8CC \uCC98\uB9AC \uC911 \uC624\uB958\uAC00 \uBC1C\uC0DD\uD588\uC2B5\uB2C8\uB2E4."}]}}},{name:"add_to_sprint",description:"\uC2A4\uD504\uB9B0\uD2B8\uC5D0 Epic\uC744 \uCD94\uAC00\uD569\uB2C8\uB2E4.",inputSchema:{type:"object",properties:{epic_url:{type:"string",description:"Epic URL (\uC608: https://company.atlassian.net/browse/PROJ-123)"},sprint_name:{type:"string",description:"\uC2A4\uD504\uB9B0\uD2B8 \uC774\uB984"},sprint_goal:{type:"string",description:"\uC774\uBC88 \uC2A4\uD504\uB9B0\uD2B8\uC758 \uBAA9\uD45C (\uC120\uD0DD\uC0AC\uD56D)"},is_carry_over:{type:"boolean",description:"\uC774\uC804 \uC2A4\uD504\uB9B0\uD2B8\uC5D0\uC11C \uC774\uC6D4\uB41C Epic\uC778\uC9C0",default:!1}},required:["epic_url","sprint_name"]},handler:async(a,e)=>f(e.epic_url)?{content:[{type:"text",text:"\u274C Sprint \uAE30\uB2A5\uC774 \uC81C\uAC70\uB418\uC5C8\uC2B5\uB2C8\uB2E4. Sprint_View\uAC00 \uB354 \uC774\uC0C1 \uC0AC\uC6A9\uB418\uC9C0 \uC54A\uC2B5\uB2C8\uB2E4."}]}:{content:[{type:"text",text:"\u274C \uC62C\uBC14\uB978 Epic URL \uD615\uC2DD\uC774 \uC544\uB2D9\uB2C8\uB2E4. \uC608: https://company.atlassian.net/browse/PROJ-123"}]}}];var x=class{constructor(){this.server=new B({name:"team-epic-mcp",version:"2.0.0"},{capabilities:{tools:{}}}),this.sheetsClient=new v,this.tools=[...P.map(e=>({name:e.name,description:e.description,inputSchema:e.inputSchema})),...b.map(e=>({name:e.name,description:e.description,inputSchema:e.inputSchema}))],this.setupHandlers()}setupHandlers(){this.server.setRequestHandler(Z,async()=>({tools:this.tools})),this.server.setRequestHandler(W,async e=>{let{name:t,arguments:r}=e.params;try{let s=P.find(n=>n.name===t);if(s){let n=await this.sheetsClient.fetchAllData();return s.handler(n,r)}let i=b.find(n=>n.name===t);if(i)return await i.handler(this.sheetsClient,r);throw new Error(`Unknown tool: ${t}`)}catch(s){return console.error(`Error executing tool ${t}:`,s),{content:[{type:"text",text:`Error: ${s instanceof Error?s.message:"Unknown error"}`}]}}})}async start(){let e=new Y;await this.server.connect(e),console.error("Team Epic MCP Server started"),console.error(`Connected to spreadsheet: ${c.SPREADSHEET_ID}`);try{await this.sheetsClient.checkAndMigrateIfNeeded()}catch(t){console.error("Migration check failed:",t)}}},K=new x;K.start().catch(console.error);
